<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="icon" type="image/x-icon" href="AgendaBookImage.ico">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda Divisi dengan Suara</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      background: #f8fafc;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .recording {
      background-color: #ffe5e5 !important;
      color: #b30000 !important;
    }
    .agenda-section {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 24px;
      margin-bottom: 24px;
    }
    .agenda-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 12px;
    }
    .btn-rekam {
      min-width: 90px;
    }
    .form-label {
      font-weight: 500;
    }
  </style>
</head>
<body class="p-4">
  <div class="container" style="max-width: 900px;">
    <h2 class="mb-4 text-center">üìí Catatan Agenda Divisi (Tertulis & Suara)</h2>
    <form id="agendaForm">
      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <label for="namaCatatan" class="form-label">Nama Catatan Agenda</label>
          <input type="text" id="namaCatatan" class="form-control" placeholder="Contoh: Rapat Mingguan" required>
        </div>
        <div class="col-md-6">
          <label for="tanggalCatatan" class="form-label">Tanggal</label>
          <input type="date" id="tanggalCatatan" class="form-control" required>
        </div>
      </div>

      <!-- Agenda Rofii -->
      <div class="agenda-section mb-3" id="rofiiSection">
        <div class="agenda-title">A. Agenda Saudara Rofii</div>
        <table class="table table-sm align-middle mb-0" id="agendaTableRofii">
          <tbody>
            <tr>
              <td style="width:5%" class="nomor">1</td>
              <td>
                <input type="text" class="form-control agenda" placeholder="Tulis atau ucapkan agenda...">
              </td>
              <td style="width:22%">
                <button type="button" class="btn btn-danger btn-sm hapus">Hapus</button>
                <button type="button" class="btn btn-warning btn-sm rekam btn-rekam">üé§ Suara</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-primary btn-sm mt-2 tambahBaris" data-target="#agendaTableRofii">‚ûï Tambah Agenda Rofii</button>
      </div>

      <!-- Agenda Deva -->
      <div class="agenda-section mb-3" id="devaSection">
        <div class="agenda-title">B. Agenda Saudara Deva</div>
        <table class="table table-sm align-middle mb-0" id="agendaTableDeva">
          <tbody>
            <tr>
              <td style="width:5%" class="nomor">1</td>
              <td>
                <input type="text" class="form-control agenda" placeholder="Tulis atau ucapkan agenda...">
              </td>
              <td style="width:22%">
                <button type="button" class="btn btn-danger btn-sm hapus">Hapus</button>
                <button type="button" class="btn btn-warning btn-sm rekam btn-rekam">üé§ Suara</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-primary btn-sm mt-2 tambahBaris" data-target="#agendaTableDeva">‚ûï Tambah Agenda Deva</button>
      </div>

      <!-- Agenda Okane -->
      <div class="agenda-section mb-3" id="okaneSection">
        <div class="agenda-title">C. Agenda Saudara Okane</div>
        <table class="table table-sm align-middle mb-0" id="agendaTableOkane">
          <tbody>
            <tr>
              <td style="width:5%" class="nomor">1</td>
              <td>
                <input type="text" class="form-control agenda" placeholder="Tulis atau ucapkan agenda...">
              </td>
              <td style="width:22%">
                <button type="button" class="btn btn-danger btn-sm hapus">Hapus</button>
                <button type="button" class="btn btn-warning btn-sm rekam btn-rekam">üé§ Suara</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-primary btn-sm mt-2 tambahBaris" data-target="#agendaTableOkane">‚ûï Tambah Agenda Okane</button>
      </div>

      <div class="d-grid gap-2 mb-4">
        <button type="button" id="gabungkan" class="btn btn-success btn-lg">üìã Gabungkan & Salin</button>
      </div>
    </form>

    <div class="agenda-section">
      <label for="hasil" class="form-label">Hasil Akhir:</label>
      <textarea id="hasil" class="form-control" rows="12" readonly></textarea>
    </div>
  </div>

  <script>
    // Fungsi update penomoran agenda pada setiap tabel
    function updateNomor(tableSelector) {
      $(tableSelector + " tbody tr").each(function(index) {
        $(this).find(".nomor").text(index + 1);
      });
    }

    $(document).ready(function() {
      // Tambah baris agenda untuk masing-masing orang
      $(".tambahBaris").click(function() {
        let tableSelector = $(this).data("target");
        let newRow = `<tr>
            <td class="nomor"></td>
            <td><input type="text" class="form-control agenda" placeholder="Tulis atau ucapkan agenda..."></td>
            <td>
              <button type="button" class="btn btn-danger btn-sm hapus">Hapus</button>
              <button type="button" class="btn btn-warning btn-sm rekam btn-rekam">üé§ Suara</button>
            </td>
          </tr>`;
        $(tableSelector + " tbody").append(newRow);
        updateNomor(tableSelector);
      });

      // Hapus baris agenda
      $(document).on("click", ".hapus", function() {
        let table = $(this).closest("table");
        $(this).closest("tr").remove();
        updateNomor("#" + table.attr("id"));
      });

      // Gabungkan hasil sesuai format
      $("#gabungkan").click(function() {
        let namaCatatan = $("#namaCatatan").val().trim();
        let tanggalCatatan = $("#tanggalCatatan").val();
        let hasil = "";
        if (namaCatatan) {
          hasil += "Nama Catatan: " + namaCatatan + "\n";
        }
        if (tanggalCatatan) {
          hasil += "Tanggal: " + tanggalCatatan + "\n";
        }
        hasil += "\nA. Agenda Saudara Rofii:\n";
        let idx = 1;
        $("#agendaTableRofii tbody tr").each(function() {
          let isi = $(this).find(".agenda").val();
          if (isi.trim() !== "") {
            hasil += idx + ". " + isi + "\n";
            idx++;
          }
        });
        hasil += "\nB. Agenda Saudara Deva:\n";
        idx = 1;
        $("#agendaTableDeva tbody tr").each(function() {
          let isi = $(this).find(".agenda").val();
          if (isi.trim() !== "") {
            hasil += idx + ". " + isi + "\n";
            idx++;
          }
        });
        hasil += "\nC. Agenda Saudara Okane:\n";
        idx = 1;
        $("#agendaTableOkane tbody tr").each(function() {
          let isi = $(this).find(".agenda").val();
          if (isi.trim() !== "") {
            hasil += idx + ". " + isi + "\n";
            idx++;
          }
        });
        $("#hasil").val(hasil);

        // otomatis copy ke clipboard
        navigator.clipboard.writeText(hasil).then(() => {
          alert("Hasil sudah disalin ke clipboard!");
        });
      });

      // Rekam suara (Speech-to-Text)
      let recognition;
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = "id-ID";
      } else {
        alert("Browser Anda tidak mendukung Speech Recognition.");
      }

      let targetInput = null;
      let rekamBtn = null;

      $(document).on("click", ".rekam", function() {
        if (!recognition) return;

        // Jika sedang merekam, stop
        if ($(this).hasClass("recording")) {
          recognition.stop();
          $(this).removeClass("recording").text("üé§ Suara");
          return;
        }

        // Reset semua tombol rekam
        $(".rekam").removeClass("recording").text("üé§ Suara");

        // Set target input dan tombol
        targetInput = $(this).closest("tr").find(".agenda");
        rekamBtn = $(this);

        $(this).addClass("recording").text("‚èπ Stop");
        recognition.start();
      });

      if (recognition) {
        recognition.onresult = function(event) {
          let hasilSuara = event.results[0][0].transcript;
          if (targetInput) {
            targetInput.val(targetInput.val() + (targetInput.val() ? " " : "") + hasilSuara);
          }
        };

        recognition.onend = function() {
          $(".rekam.recording").removeClass("recording").text("üé§ Suara");
        };
      }

      // Inisialisasi penomoran awal
      updateNomor("#agendaTableRofii");
      updateNomor("#agendaTableDeva");
      updateNomor("#agendaTableOkane");
    });
  </script>
</body>
</html>
