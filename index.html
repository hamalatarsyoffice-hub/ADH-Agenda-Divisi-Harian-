<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="icon" type="image/x-icon" href="AgendaBookImage.ico">
  <link rel="icon" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/icons/journal-bookmark-fill.svg" type="image/svg+xml">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda Divisi dengan Suara</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      background: #f8fafc;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .recording {
      background-color: #ffe5e5 !important;
      color: #b30000 !important;
    }
    .agenda-section {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 24px;
      margin-bottom: 24px;
    }
    .agenda-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 12px;
    }
    .btn-rekam {
      min-width: 90px;
    }
    .form-label {
      font-weight: 500;
    }
    .urgency-select {
      min-width: 60px;
      font-size: 0.95rem;
      padding: 2px 8px;
      border-radius: 6px;
      margin-right: 6px;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      color: #333;
    }
    .agenda-title strong {
      font-weight: bold;
    }
    /* Responsive improvements for mobile */
    @media (max-width: 600px) {
      .container {
        padding: 0 !important;
        max-width: 100vw !important;
      }
      .agenda-section {
        padding: 12px;
        margin-bottom: 16px;
      }
      .agenda-title {
        font-size: 1rem;
        margin-bottom: 8px;
      }
      .form-label {
        font-size: 0.98rem;
      }
      .urgency-select {
        min-width: 48px;
        font-size: 0.92rem;
        margin-right: 2px;
        padding: 2px 4px;
      }
      .agenda input.form-control.agenda {
        min-width: 0 !important;
        width: 100% !important;
        font-size: 0.98rem;
      }
      table.table {
        font-size: 0.97rem;
      }
      #agendaForm .row.g-3 > .col-md-6 {
        flex: 0 0 100%;
        max-width: 100%;
      }
      #agendaForm .input-group {
        flex-wrap: nowrap;
      }
      #agendaForm .input-group input,
      #agendaForm .input-group button {
        font-size: 0.98rem;
      }
      /* Make table horizontally scrollable if needed */
      .agenda-section table {
        display: block;
        width: 100%;
        overflow-x: auto;
      }
      .agenda-section table tbody,
      .agenda-section table tr {
        display: table;
        width: 100%;
      }
      .agenda-section table td {
        white-space: nowrap;
        vertical-align: middle;
      }
    }
  </style>
</head>
<body class="p-4">
  <div class="container" style="max-width: 900px;">
    <h2 class="mb-4 text-center">📒 Catatan Agenda Divisi (Tertulis & Suara)</h2>
    <form id="agendaForm">
      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <label for="namaCatatan" class="form-label">Nama Catatan Agenda</label>
          <div class="input-group">
            <input type="text" id="namaCatatan" class="form-control" placeholder="Contoh: Rapat Mingguan" required>
            <button type="button" class="btn btn-warning btn-sm" id="rekamJudul" title="Isi judul dengan suara">🎤</button>
          </div>
        </div>
        <div class="col-md-6">
          <label for="tanggalCatatan" class="form-label">Tanggal</label>
          <input type="date" id="tanggalCatatan" class="form-control" required>
        </div>
      </div>

      <!-- Agenda Rofii -->
      <div class="agenda-section mb-3" id="rofiiSection">
        <div class="agenda-title"><strong>A. Agenda Sdr Rofii</strong></div>
        <table class="table table-sm align-middle mb-0" id="agendaTableRofii">
          <tbody>
            <tr>
              <td style="width:5%" class="nomor">1</td>
              <td>
                <input type="text" class="form-control agenda" style="min-width:420px;max-width:100%;" placeholder="Tulis atau ucapkan agenda...">
              </td>
              <td>
                <button type="button" class="btn btn-danger btn-sm hapus">Hapus</button>
                <button type="button" class="btn btn-warning btn-sm rekam btn-rekam">🎤 Suara</button>
                <select class="urgency-select ms-1">
                  <option value="U">U</option>
                  <option value="D">D</option>
                  <option value="S">S</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-primary btn-sm mt-2 tambahBaris" data-target="#agendaTableRofii">➕ Tambah Agenda Rofii</button>
      </div>

      <!-- Agenda Deva -->
      <div class="agenda-section mb-3" id="devaSection">
        <div class="agenda-title">B. Agenda Sdr Deva</div>
        <table class="table table-sm align-middle mb-0" id="agendaTableDeva">
          <tbody>
            <tr>
              <td style="width:5%" class="nomor">1</td>
              <td>
                <input type="text" class="form-control agenda" style="min-width:420px;max-width:100%;" placeholder="Tulis atau ucapkan agenda...">
              </td>
              <td>
                <button type="button" class="btn btn-danger btn-sm hapus">Hapus</button>
                <button type="button" class="btn btn-warning btn-sm rekam btn-rekam">🎤 Suara</button>
                <select class="urgency-select ms-1">
                  <option value="U">U</option>
                  <option value="D">D</option>
                  <option value="S">S</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-primary btn-sm mt-2 tambahBaris" data-target="#agendaTableDeva">➕ Tambah Agenda Deva</button>
      </div>

      <!-- Agenda Okane -->
      <div class="agenda-section mb-3" id="okaneSection">
        <div class="agenda-title">C. Agenda Sdr Okane</div>
        <table class="table table-sm align-middle mb-0" id="agendaTableOkane">
          <tbody>
            <tr>
              <td style="width:5%" class="nomor">1</td>
              <td>
                <input type="text" class="form-control agenda" style="min-width:420px;max-width:100%;" placeholder="Tulis atau ucapkan agenda...">
              </td>
              <td>
                <button type="button" class="btn btn-danger btn-sm hapus">Hapus</button>
                <button type="button" class="btn btn-warning btn-sm rekam btn-rekam">🎤 Suara</button>
                <select class="urgency-select ms-1">
                  <option value="U">U</option>
                  <option value="D">D</option>
                  <option value="S">S</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-primary btn-sm mt-2 tambahBaris" data-target="#agendaTableOkane">➕ Tambah Agenda Okane</button>
      </div>

      <div class="d-grid gap-2 mb-4">
        <button type="button" id="gabungkan" class="btn btn-success btn-lg">📋 Gabungkan & Salin</button>
      </div>
    </form>

    <div class="agenda-section">
      <label for="hasil" class="form-label">Hasil Akhir:</label>
      <textarea id="hasil" class="form-control" rows="12" readonly></textarea>
    </div>
  </div>

  <script>
    // Fungsi update penomoran agenda pada setiap tabel
    function updateNomor(tableSelector) {
      $(tableSelector + " tbody tr").each(function(index) {
        $(this).find(".nomor").text(index + 1);
      });
    }

    $(document).ready(function() {
      // Tambah baris agenda untuk masing-masing orang
      $(".tambahBaris").click(function() {
        let tableSelector = $(this).data("target");
        let newRow = `<tr>
            <td class="nomor"></td>
            <td>
              <input type="text" class="form-control agenda" style="min-width:420px;max-width:100%;" placeholder="Tulis atau ucapkan agenda...">
            </td>
            <td>
              <button type="button" class="btn btn-danger btn-sm hapus">Hapus</button>
              <button type="button" class="btn btn-warning btn-sm rekam btn-rekam">🎤 Suara</button>
              <select class="urgency-select ms-1">
                <option value="U">U</option>
                <option value="D">D</option>
                <option value="S">S</option>
              </select>
            </td>
          </tr>`;
        $(tableSelector + " tbody").append(newRow);
        updateNomor(tableSelector);
      });

      // Hapus baris agenda
      $(document).on("click", ".hapus", function() {
        let table = $(this).closest("table");
        $(this).closest("tr").remove();
        updateNomor("#" + table.attr("id"));
      });

      // Gabungkan hasil sesuai format
      $("#gabungkan").click(function() {
        let namaCatatan = $("#namaCatatan").val().trim();
        let tanggalCatatan = $("#tanggalCatatan").val();
        let hasil = "";
        if (namaCatatan) {
          hasil += "Nama Catatan: " + namaCatatan + "\n";
        }
        if (tanggalCatatan) {
          hasil += "Tanggal: " + tanggalCatatan + "\n";
        }
        hasil += "\nA. Agenda Sdr Rofii:\n";
        let idx = 1;
        $("#agendaTableRofii tbody tr").each(function() {
          let isi = $(this).find(".agenda").val();
          let urg = $(this).find(".urgency-select").val();
          if (isi.trim() !== "") {
            hasil += idx + ". [" + urg + "] " + isi + "\n";
            idx++;
          }
        });
        hasil += "\nB. Agenda Sdr Deva:\n";
        idx = 1;
        $("#agendaTableDeva tbody tr").each(function() {
          let isi = $(this).find(".agenda").val();
          let urg = $(this).find(".urgency-select").val();
          if (isi.trim() !== "") {
            hasil += idx + ". [" + urg + "] " + isi + "\n";
            idx++;
          }
        });
        hasil += "\nC. Agenda Sdr Okane:\n";
        idx = 1;
        $("#agendaTableOkane tbody tr").each(function() {
          let isi = $(this).find(".agenda").val();
          let urg = $(this).find(".urgency-select").val();
          if (isi.trim() !== "") {
            hasil += idx + ". [" + urg + "] " + isi + "\n";
            idx++;
          }
        });
        // Tambahan keterangan di akhir hasil
        hasil += "\nJangan lupa laporan di group telegram sebelum pulang kerja.\n";
        hasil += "\nKode Urgency:\n";
        hasil += "- U (Sangat Penting)\n";
        hasil += "- D (Perlu Laporan Segera)\n";
        hasil += "- S (Santai)\n";
        $("#hasil").val(hasil);

        // otomatis copy ke clipboard
        navigator.clipboard.writeText(hasil).then(() => {
          alert("Hasil sudah disalin ke clipboard!");
        });
      });

      // Rekam suara (Speech-to-Text)
      let recognition;
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = "id-ID";
      } else {
        alert("Browser Anda tidak mendukung Speech Recognition.");
      }

      let targetInput = null;
      let rekamBtn = null;

      $(document).on("click", ".rekam", function() {
        if (!recognition) return;

        // Jika sedang merekam, stop
        if ($(this).hasClass("recording")) {
          recognition.stop();
          $(this).removeClass("recording").text("🎤 Suara");
          return;
        }

        // Reset semua tombol rekam
        $(".rekam").removeClass("recording").text("🎤 Suara");

        // Set target input dan tombol
        targetInput = $(this).closest("tr").find(".agenda");
        rekamBtn = $(this);

        $(this).addClass("recording").text("⏹ Stop");
        recognition.start();
      });

      // Rekam suara untuk judul
      let rekamJudulAktif = false;
      $("#rekamJudul").click(function() {
        if (!recognition) return;
        if (rekamJudulAktif) {
          recognition.stop();
          $(this).removeClass("recording").text("🎤");
          rekamJudulAktif = false;
          return;
        }
        // Reset
        $(this).addClass("recording").text("⏹");
        rekamJudulAktif = true;
        targetInput = $("#namaCatatan");
        rekamBtn = $(this);
        recognition.start();
      });

      if (recognition) {
        recognition.onresult = function(event) {
          let hasilSuara = event.results[0][0].transcript;
          if (targetInput) {
            targetInput.val(targetInput.val() + (targetInput.val() ? " " : "") + hasilSuara);
          }
        };

        recognition.onend = function() {
          $(".rekam.recording").removeClass("recording").text("🎤 Suara");
          $("#rekamJudul.recording").removeClass("recording").text("🎤");
          rekamJudulAktif = false;
        };
      }

      // Inisialisasi penomoran awal
      updateNomor("#agendaTableRofii");
      updateNomor("#agendaTableDeva");
      updateNomor("#agendaTableOkane");
    });
  </script>
</body>
</html>
